server {
    listen 80;

    # Proxy /sparql to qEndpoint
    location /sparql {
        # Allow only HTTP GET and HEAD (no POST, PUT, PATCH, DELETE)
        limit_except GET HEAD {
            deny all;
        }

        # Forward incoming requests to the backend SPARQL endpoint service
        # "qendpoint" is the Docker container hostname/service name within the Docker network
        # and "1234" is the internal port the service listens on.
        # This direct container-to-container communication bypasses host port mappings.
        proxy_pass http://qendpoint:1234/api/endpoint/sparql;

        # Forward the original Host header from the client to the backend
        # Important because backend services often use the Host header for routing or validation.
        proxy_set_header Host $host;

        # Send the client's real IP address to the backend via the X-Real-IP header
        # Without this, backend logs and security rules would only see the proxy's IP.
        proxy_set_header X-Real-IP $remote_addr;

        # Remove the X-Powered-By header added by some backend frameworks,
        # which helps avoid revealing sensitive backend implementation details to clients.
        proxy_hide_header X-Powered-By;
    }

    # Proxy static web UI
    location / {
        limit_except GET HEAD {
            deny all;
        }
        proxy_pass http://geonames-web:80;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_hide_header X-Powered-By;
    }
}