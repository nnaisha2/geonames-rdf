services:
  qendpoint:
    image: qacompany/qendpoint
    container_name: qendpoint
    ports:
      - "7400:1234"
    environment:
      - MEM_SIZE=2G

  nginx:
    image: nginx:alpine
    container_name: qendpoint-nginx
    ports:
      - "8080:8080"
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - qendpoint

  geonames-upload:
    build: .
    container_name: geonames-upload
    environment:
      - UPLOAD_QENDPOINT=true
      - QENDPOINT_HOST=qendpoint
      - COUNTRY_CODE
    volumes:
      - ./output:/output
    depends_on:
      - qendpoint
    command: ["./entrypoint-upload.sh", "${COUNTRY_CODE}"]
